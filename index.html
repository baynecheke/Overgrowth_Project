<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overgrowth</title>
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#e8f5e9; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; overflow-x:hidden; padding-top:20px;}
#loadingScreen { position:absolute; width:100%; height:100%; display:flex; justify-content:center; align-items:center; flex-direction:column;
    background:linear-gradient(to top,#a5d6a7,#66bb6a); color:white; font-size:2em; text-shadow:2px 2px 6px black; z-index:10;}
#progressBar { width:80%; height:20px; background:#ddd; border-radius:10px; margin-top:20px; overflow:hidden;}
#progressFill { width:0%; height:100%; background:#4caf50;}
#flowerCanvas { width:150px; height:150px; margin:20px;}
#gameContainer { display:none; flex-direction:column; align-items:center; width:100%; max-width:1200px; }
.board { display:flex; justify-content:space-between; width:100%; margin-top:20px; }
.playerBoard { display:flex; flex-direction:column; align-items:center; }
.cardsRow { display:flex; margin:5px 0; flex-wrap:wrap; }
.card { width:120px; height:180px; perspective:1000px; margin:5px; cursor:pointer; }
.cardInner { position:relative; width:100%; height:100%; text-align:center; transition: transform 0.6s; transform-style: preserve-3d; }
.card.flipped .cardInner { transform: rotateY(180deg); }
.cardFront, .cardBack { position:absolute; width:100%; height:100%; backface-visibility: hidden; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.3); display:flex; flex-direction:column; justify-content:flex-start; align-items:center; padding:5px; box-sizing:border-box; }
.cardFront { background:white; }
.cardBack { background:#f0f0f0; transform: rotateY(180deg); font-size:12px; overflow-wrap:break-word; }
.stats, .status { width:100%; text-align:center; font-size:12px; margin:2px 0; background:rgba(255,255,255,0.8); padding:2px 4px; border-radius:6px; box-sizing:border-box; }
.hpBar { height:10px; width:100%; background:#ddd; border-radius:5px; overflow:hidden; margin-top:2px; }
.hpFill { height:100%; background:#f44336; transition:width 0.3s; }
.energyBar { height:6px; width:100%; background:#ddd; border-radius:3px; overflow:hidden; margin-top:2px; }
.energyFill { height:100%; background:#ffeb3b; transition:width 0.3s; }
.highlight { box-shadow:0 0 20px yellow;}
#actions { margin-top:10px; display:flex; flex-wrap:wrap; justify-content:center; }
button { margin:5px; padding:8px 15px; font-size:14px; border-radius:5px; border:none; background:#4caf50; color:white; cursor:pointer; }
button:hover { background:#45a049; }
#combatLog { max-height:200px; overflow-y:auto; width:90%; background:#fff; padding:10px; margin-top:10px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.2); font-size:14px; word-wrap:break-word; }
.damagePop { position:absolute; color:red; font-weight:bold; animation:pop 0.8s ease-out forwards; }
.healPop { position:absolute; color:green; font-weight:bold; animation:pop 0.8s ease-out forwards; }
@keyframes pop { 0% {opacity:1; transform:translateY(0);} 100% {opacity:0; transform:translateY(-30px);} }
</style>
</head>
<body>
<div id="loadingScreen">
  <div>Loading Overgrowth...</div>
  <canvas id="flowerCanvas" width="150" height="150"></canvas>
  <div id="progressBar"><div id="progressFill"></div></div>
</div>

<div id="gameContainer">
<h1>Overgrowth</h1>
<div id="garden" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
<button id="finishDraft">Finish Draft</button>
<div class="board">
<div class="playerBoard" id="playerBoard">
<h2>You</h2>
<div class="cardsRow" id="playerActive"></div>
<div class="cardsRow" id="playerBench"></div>
</div>
<div class="playerBoard" id="aiBoard">
<h2>AI</h2>
<div class="cardsRow" id="aiActive"></div>
<div class="cardsRow" id="aiBench"></div>
</div>
</div>
<div id="actions"></div>
<div id="combatLog"></div>
</div>

<script>
// --- Types and advantages ---
const types=['Sun','Water','Thorn','Fungal','Normal','Nocturnal'];
const typeAdvantage={'Nocturnal':'Fungal','Fungal':'Normal','Normal':'Thorn','Thorn':'Water','Water':'Sun','Sun':'Nocturnal'};

// --- Game variables ---
let gardenDeck=[], playerDeck=[], aiDeck=[], combatLog=[];
let playerFormation={}, aiFormation={}, currentPlayer=null;

// --- Logging ---
function log(msg,type='normal'){ 
    const logEl=document.getElementById('combatLog'); 
    let color=type==='damage'?'red': type==='heal'?'green':'black';
    combatLog.push(`<span style="color:${color}">${msg}</span>`); 
    logEl.innerHTML=combatLog.join('<br>'); 
    logEl.scrollTop=logEl.scrollHeight; 
}

// --- Card art ---
function drawCardArt(name,type){
    const canvas=document.createElement('canvas');
    canvas.width=120; canvas.height=80;
    const ctx=canvas.getContext('2d');
    const colors = {Sun:'#ffe082',Water:'#64b5f6',Thorn:'#81c784',Fungal:'#ba68c8',Normal:'#e0e0e0',Nocturnal:'#455a64'};
    ctx.fillStyle = colors[type]||'#fff';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle='#333'; ctx.lineWidth=2; ctx.strokeRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle='#000'; ctx.font='bold 14px sans-serif'; ctx.textAlign='center'; ctx.fillText(name,canvas.width/2,20);
    ctx.font='12px sans-serif'; ctx.fillText(type,canvas.width/2,35);
    return canvas;
}

// --- Card creation ---
function createCard(name){
    const type=types[Math.floor(Math.random()*types.length)];
    const hp=Math.floor(Math.random()*20)+10;
    const atk=Math.floor(Math.random()*10)+5;
    const energy=Math.floor(Math.random()*3)+1;
    const keywords = ['Quick','Poison','Regenerate','Shield'];
    const passive = (self)=>{ if(self.hp<self.maxHp/2) self.atk+=2; };
    const active = (self,ally)=>{ 
        if(self.energy>=1){ 
            let target=ally.find(c=>c.hp<c.maxHp); 
            if(target){ target.hp=Math.min(target.maxHp,target.hp+5); self.energy--; showHeal(target,'+5'); log(`${self.name} heals ${target.name} 5 HP.`,'heal'); }
        } 
    };
    const illustration=drawCardArt(name,type);
    return {name,type,hp,maxHp:hp,atk,baseAtk:atk,energy,maxEnergy:energy,exhausted:false,statuses:[],keywords,passive,active,illustration};
}

// --- Drafting ---
function initGame(){
    const garden=document.getElementById('garden'); garden.innerHTML='';
    const cardNames=['Rose','Cactus','Mushroom','Sunflower','Nightshade','Fern','Lily','Ivy','Daisy','Orchid','Bamboo','Tulip'];
    gardenDeck=cardNames.map(name=>createCard(name));
    gardenDeck.forEach(card=>{
        const el=createCardElement(card,false);
        el.onclick=()=>{ 
            if(playerDeck.length<3){ 
                playerDeck.push(card); 
                el.classList.add('highlight'); 
            }
        };
        garden.appendChild(el);
    });
    aiDeck=aiDraft(3,gardenDeck);
}

function aiDraft(n,cards){ let selected=[]; while(selected.length<n){ let best=cards[Math.floor(Math.random()*cards.length)]; if(!selected.includes(best)) selected.push(best);} return selected; }

// --- Card element ---
function createCardElement(card,showStats=true){
    const container=document.createElement('div'); container.classList.add('card');
    const inner=document.createElement('div'); inner.className='cardInner';
    container.appendChild(inner);

    const front=document.createElement('div'); front.className='cardFront';
    front.appendChild(card.illustration);
    if(showStats){
        const stats=document.createElement('div'); stats.className='stats';
        stats.innerHTML=`ATK:${card.atk} | HP:${card.hp}/${card.maxHp} | Energy:${card.energy}`;
        front.appendChild(stats);
    }

    const back=document.createElement('div'); back.className='cardBack';
    back.innerHTML=`<strong>${card.name}</strong><br>Type: ${card.type}<br>ATK: ${card.atk}<br>HP: ${card.hp}/${card.maxHp}<br>Energy: ${card.energy}<br>Keywords: ${card.keywords.join(', ')}`;

    inner.appendChild(front); inner.appendChild(back);

    container.onclick=()=>{ container.classList.toggle('flipped'); };
    card.element = container; // link card to DOM element
    return container;
}

// --- Finish draft ---
document.getElementById('finishDraft').onclick=()=>{
    if(playerDeck.length!==3){alert('Pick 3 cards'); return;}
    document.getElementById('garden').style.display='none';
    document.getElementById('finishDraft').style.display='none';
    document.getElementById('loadingScreen').style.display='none';
    startCombat();
}

// --- Flower animation ---
let progress=0;
const flowerCanvas=document.getElementById('flowerCanvas');
const fCtx=flowerCanvas.getContext('2d');
function drawFlower(p){
    fCtx.clearRect(0,0,150,150);
    fCtx.fillStyle='#4caf50';
    fCtx.beginPath();
    fCtx.arc(75,75,10+p*50,0,Math.PI*2);
    fCtx.fill();
}
let loadInterval=setInterval(()=>{
    progress+=0.01;
    if(progress>1) progress=1;
    drawFlower(progress);
    document.getElementById('progressFill').style.width=(progress*100)+'%';
    if(progress>=1){ clearInterval(loadInterval); setTimeout(()=>{ document.getElementById('loadingScreen').style.display='none'; document.getElementById('gameContainer').style.display='flex'; initGame(); },500);}
},50);

// --- Combat system ---
let actionsDiv = document.getElementById('actions');

function startCombat(){
    playerFormation.active = playerDeck.slice();
    playerFormation.bench = [];
    aiFormation.active = aiDeck.slice();
    aiFormation.bench = [];
    log("Combat begins!");
    currentPlayer='player';
    updateBoard();
    promptPlayerAction();
}

function updateBoard(){
    function render(containerId,cards){
        const container=document.getElementById(containerId); container.innerHTML='';
        cards.forEach(c=>{
            // Update front stats
            const front = c.element.querySelector('.cardFront .stats');
            if(front) front.innerHTML=`ATK:${c.atk} | HP:${c.hp}/${c.maxHp} | Energy:${c.energy}`;
            container.appendChild(c.element);
        });
    }
    render('playerActive',playerFormation.active);
    render('aiActive',aiFormation.active);
}

function showDamage(card,amount){ const dmg=document.createElement('div'); dmg.classList.add('damagePop'); dmg.textContent=amount; document.body.appendChild(dmg); setTimeout(()=>document.body.removeChild(dmg),800);}
function showHeal(card,amount){ const heal=document.createElement('div'); heal.classList.add('healPop'); heal.textContent=amount; document.body.appendChild(heal); setTimeout(()=>document.body.removeChild(heal),800);}

// --- Player actions ---
function promptPlayerAction(){
    if(playerFormation.active.length===0 || aiFormation.active.length===0){ checkVictory(); return;}
    actionsDiv.innerHTML='';
    playerFormation.active.forEach(card=>{
        if(card.exhausted) return;
        const btn=document.createElement('button'); btn.textContent=`Use ${card.name}`;
        btn.onclick=()=>{ chooseCardAction(card); };
        actionsDiv.appendChild(btn);
    });
}

function chooseCardAction(card){
    actionsDiv.innerHTML='';
    const attackBtn=document.createElement('button'); attackBtn.textContent='Attack';
    attackBtn.onclick=()=>{ chooseTarget(card); };
    const abilityBtn=document.createElement('button'); abilityBtn.textContent='Use Ability';
    abilityBtn.onclick=()=>{
        card.active(card,playerFormation.active);
        if(card.energy<=0){ card.exhausted=true; card.energy=0;}
        updateBoard();
        setTimeout(aiTurn,500);
    };
    const passBtn=document.createElement('button'); passBtn.textContent='Pass';
    passBtn.onclick=()=>{ card.exhausted=true; setTimeout(aiTurn,500);}
    actionsDiv.appendChild(attackBtn); actionsDiv.appendChild(abilityBtn); actionsDiv.appendChild(passBtn);
}

function chooseTarget(attacker){
    actionsDiv.innerHTML='Select a target:';
    aiFormation.active.forEach(target=>{
        const btn=document.createElement('button'); btn.textContent=target.name;
        btn.onclick=()=>{
            let dmg=attacker.atk; if(typeAdvantage[attacker.type]===target.type) dmg+=10;
            target.hp-=dmg; showDamage(target,dmg); log(`${attacker.name} attacks ${target.name} for ${dmg}`,'damage');
            if(target.hp<=0){ aiFormation.active=aiFormation.active.filter(c=>c!==target); log(`${target.name} defeated!`);}
            attacker.energy--; if(attacker.energy<=0){ attacker.exhausted=true; attacker.energy=0;}
            updateBoard(); setTimeout(aiTurn,500);
        };
        actionsDiv.appendChild(btn);
    });
}

// --- AI Turn ---
function aiTurn(){
    if(aiFormation.active.length===0||playerFormation.active.length===0){ checkVictory(); return;}
    let card=aiFormation.active.find(c=>!c.exhausted);
    if(!card){
        playerFormation.active.forEach(c=>c.exhausted=false);
        aiFormation.active.forEach(c=>c.exhausted=false);
        promptPlayerAction(); return;
    }
    let target=playerFormation.active.reduce((a,b)=>(b.hp<a.hp?b:a),playerFormation.active[0]);
    let dmg=card.atk; if(typeAdvantage[card.type]===target.type) dmg+=10;
    target.hp-=dmg; showDamage(target,dmg); log(`AI's ${card.name} attacks ${target.name} for ${dmg}`,'damage');
    if(target.hp<=0){ playerFormation.active=playerFormation.active.filter(c=>c!==target); log(`${target.name} defeated!`);}
    card.energy--; if(card.energy<=0){ card.exhausted=true; card.energy=0;}
    updateBoard(); setTimeout(promptPlayerAction,500);
}

// --- Victory check ---
function checkVictory(){
    if(playerFormation.active.length===0){ alert('AI Wins!'); log('AI Wins!'); return true;}
    if(aiFormation.active.length===0){ alert('You Win!'); log('You Win!'); return true;}
}
</script>
</body>
</html>


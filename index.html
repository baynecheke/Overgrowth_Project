<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overgrowth Game</title>
<style>
body {margin:0;font-family:sans-serif;background:#87CEEB;overflow:hidden;position:relative;}

/* Loading Screen */
#loadingScreen{
  position:fixed; top:0; left:0; width:100%; height:100%;
  display:flex; justify-content:center; align-items:center; flex-direction:column;
  background:#87CEEB; z-index:1000;
}
#sun{
  width:60px; height:60px; border-radius:50%; background:yellow;
  box-shadow:0 0 30px yellow; animation:glow 2s ease-in-out infinite;
  margin-bottom:20px;
}
#loadingBarContainer{
  width:80%; height:20px; background:#fff; border-radius:10px; overflow:hidden; position:relative;
}
#loadingBar{width:0%; height:100%; background:gold; transition:width 0.2s ease;}
#loadingText{margin-top:10px; font-weight:bold;}

/* Login / Sign Up */
#loginMenu, #mainMenu{display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:#87CEEB; z-index:900; display:flex; flex-direction:column;
  justify-content:center; align-items:center;
}
#loginMenu input{margin:5px; padding:10px; font-size:16px;}
#loginMenu label{margin-top:10px;}
#loginMenu button{padding:10px 20px; font-size:16px; margin-top:10px; cursor:pointer;}
#loginError{color:red; font-weight:bold; margin-top:10px;}

/* Tips */
#tipsBtn{
  position:absolute; bottom:20px; left:20px; font-size:32px; cursor:pointer;
  background:#fff; border:2px solid #333; border-radius:50%; width:50px; height:50px; display:flex;
  justify-content:center; align-items:center;
}
#tipsPanel{
  display:none; position:absolute; bottom:80px; left:20px; width:250px; background:#fff; border:2px solid #333;
  border-radius:8px; padding:10px; z-index:910;
}

/* Game Screen */
#gameScreen{display:none; padding:20px; text-align:center; position:relative;}
#playerPanel, #enemyPanel{margin:10px; display:flex; justify-content:center; flex-wrap:wrap;}
.card{display:inline-block; width:120px; height:auto; margin:10px; padding:5px; background:#fff; border:2px solid #333; border-radius:8px; position:relative; cursor:pointer; transition:transform 0.3s,border 0.3s,box-shadow 0.3s;}
.card:hover{transform:scale(1.05); box-shadow:0 0 10px rgba(0,0,0,0.2);}
.card.selected{border:3px solid gold; box-shadow:0 0 20px yellow;}
.card.enemy:hover{box-shadow:0 0 20px crimson;}
.healthBar{width:100%; height:12px; background:red; border-radius:6px; overflow:hidden; margin-top:4px;}
.healthFill{height:100%; background:green; width:100%; transition:width 0.5s ease;}
.cardData{font-size:12px; margin-top:4px; text-align:left;}
#message{margin-top:20px; font-weight:bold; min-height:24px;}
#options{margin-top:10px;}
.optionBtn{padding:8px 12px; margin:3px; font-size:14px; cursor:pointer; transition:background 0.3s;}
.optionBtn:hover{background:#ffd700;}
#winScreen{display:none; text-align:center; padding:20px;}
button{padding:10px 20px; font-size:16px; margin-top:20px;}

/* Settings Button */
#settingsBtn{
  position:absolute; top:10px; right:10px; z-index:100;
  padding:8px 12px; cursor:pointer; background:#fff; border:2px solid #333; border-radius:6px;
}
#settingsPanel{
  position:absolute; top:50px; right:10px; width:180px; background:#fff; border:2px solid #333; border-radius:8px; padding:10px;
  display:none; z-index:101;
}
#settingsPanel label{display:block; margin:8px 0; cursor:pointer;}

/* Animations */
@keyframes glow{0%{box-shadow:0 0 10px yellow;}50%{box-shadow:0 0 35px yellow;}100%{box-shadow:0 0 10px yellow;}}
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loadingScreen">
  <div id="sun"></div>
  <div id="loadingBarContainer">
    <div id="loadingBar"></div>
  </div>
  <p id="loadingText">Loading 0%</p>
</div>

<!-- Login Menu -->
<div id="loginMenu">
  <h1>Overgrowth</h1>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <label><input type="checkbox" id="rememberMe"> Remember Me</label>
  <button id="loginBtn">Login / Play</button>
  <p id="loginError"></p>
</div>

<!-- Main Menu -->
<div id="mainMenu">
  <h1>Overgrowth</h1>
  <button id="playBtn">Play</button>
  <div id="tipsBtn">?</div>
  <div id="tipsPanel">
    <h3>Tips / How to Play</h3>
    <ul>
      <li>Select a card to see its actions.</li>
      <li>Click an action, then an enemy to attack.</li>
      <li>Use buffs to heal or strengthen your cards.</li>
      <li>Defeat all enemy cards to win.</li>
    </ul>
  </div>
</div>

<!-- Game Screen -->
<div id="gameScreen">
  <button id="settingsBtn">Settings ⚙️</button>
  <div id="settingsPanel">
    <label><input type="checkbox" id="muteMusic"> Mute Music</label>
    <label><input type="checkbox" id="muteSFX"> Mute Sound Effects</label>
    <button onclick="closeSettings()">Close</button>
  </div>

  <h3>Your Cards</h3>
  <div id="playerPanel"></div>
  <h3>Enemy Cards</h3>
  <div id="enemyPanel"></div>
  <p id="message"></p>
  <div id="options"></div>
</div>

<!-- Win Screen -->
<div id="winScreen">
<h1 id="winMessage"></h1>
<button onclick="restartGame()">Restart</button>
</div>

<script>
// ---------------- Loading Screen ----------------
const loadingBar=document.getElementById('loadingBar');
const loadingText=document.getElementById('loadingText');
const loadingScreen=document.getElementById('loadingScreen');
const loginMenu=document.getElementById('loginMenu');

let loadPercent=0;
const loadInterval=setInterval(()=>{
  loadPercent++;
  loadingBar.style.width=loadPercent+'%';
  loadingText.textContent='Loading '+loadPercent+'%';
  if(loadPercent>=100){
    clearInterval(loadInterval);
    setTimeout(()=>{
      loadingScreen.style.display='none';
      loginMenu.style.display='flex';
      checkRememberMe();
    },500);
  }
},30);

// ---------------- Audio Setup ----------------
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let musicMuted=false;
let sfxMuted=false;

function playSound(frequency,duration=0.2,type='square'){
  if(sfxMuted) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type;
  osc.frequency.value = frequency;
  gain.gain.setValueAtTime(0.2,audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+duration);
  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime+duration);
}

function playCardSelect(){ playSound(660,0.2,'sine'); }
function playAttack(){ playSound(440,0.3,'square'); }
function playHeal(){ playSound(550,0.3,'triangle'); }
function playWin(){ playSound(880,0.5,'triangle'); }
function playLose(){ playSound(220,0.5,'sawtooth'); }

let bgInterval=null;
function playBackgroundMusic(){
  if(musicMuted) return;
  const bpm=90;
  const interval=(60/bpm)*1000;
  const notes=[261.63,293.66,329.63,349.23,392.00];
  bgInterval=setInterval(()=>{
    if(musicMuted) return;
    const osc=audioCtx.createOscillator();
    const gain=audioCtx.createGain();
    osc.type='sine';
    osc.frequency.value=notes[Math.floor(Math.random()*notes.length)];
    gain.gain.value=0.1;
    osc.connect(gain).connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime+0.3);
  },interval);
}

function stopBackgroundMusic(){ if(bgInterval) clearInterval(bgInterval); }

// ---------------- Login ----------------
const loginBtn=document.getElementById('loginBtn');
loginBtn.onclick=()=>{
  const username=document.getElementById('username').value;
  const password=document.getElementById('password').value;
  const rememberMe=document.getElementById('rememberMe').checked;

  if(username && password){
    // Save login if Remember Me
    if(rememberMe){
      localStorage.setItem('ogUsername',username);
      localStorage.setItem('ogPassword',password);
    } else {
      localStorage.removeItem('ogUsername');
      localStorage.removeItem('ogPassword');
    }
    loginMenu.style.display='none';
    gameScreen.style.display='block';
    startGame();
  } else {
    document.getElementById('loginError').textContent='Enter username and password!';
  }
};

function checkRememberMe(){
  const savedUser=localStorage.getItem('ogUsername');
  const savedPass=localStorage.getItem('ogPassword');
  if(savedUser && savedPass){
    document.getElementById('username').value=savedUser;
    document.getElementById('password').value=savedPass;
    document.getElementById('rememberMe').checked=true;
  }
}

// ---------------- Game Data ----------------
let playerCards=[],enemyCards=[];
let selectedPlayerCard=null,selectedAction=null;
function createCard(name,hp,actions){return{name,maxHp:hp,hp,actions};}
function draftCards(deck,count){
  const draft=[]; const copy=[...deck];
  for(let i=0;i<count;i++){
    const index=Math.floor(Math.random()*copy.length);
    draft.push(copy.splice(index,1)[0]);
  }
  return draft;
}

function startGame(){initCards(); renderCards();}

// Expanded Card Pool (20+)
function initCards(){
  const playerDeck=[
    createCard('Sunflower',40,[{name:'Sunbeam',type:'attack',value:15},{name:'Grow',type:'buff',value:10}]),
    createCard('Rose',50,[{name:'Thorn Strike',type:'attack',value:20},{name:'Shield',type:'buff',value:15}]),
    createCard('Tulip',35,[{name:'Petal Slash',type:'attack',value:12},{name:'Heal',type:'buff',value:10}]),
    createCard('Daisy',30,[{name:'Quick Hit',type:'attack',value:10},{name:'Regenerate',type:'buff',value:12}]),
    createCard('Orchid',45,[{name:'Poison Bloom',type:'attack',value:18},{name:'Camouflage',type:'buff',value:12}]),
    createCard('Lily',38,[{name:'Water Splash',type:'attack',value:14},{name:'Revitalize',type:'buff',value:15}]),
    createCard('Marigold',32,[{name:'Solar Beam',type:'attack',value:16},{name:'Harden',type:'buff',value:10}]),
    createCard('Poppy',28,[{name:'Sleep Dust',type:'attack',value:12},{name:'Shield',type:'buff',value:8}]),
    createCard('Iris',36,[{name:'Petal Storm',type:'attack',value:18},{name:'Focus',type:'buff',value:12}]),
    createCard('Carnation',33,[{name:'Thorn Whip',type:'attack',value:15},{name:'Regrow',type:'buff',value:10}]),
    createCard('Bluebell',34,[{name:'Bell Strike',type:'attack',value:14},{name:'Soothing',type:'buff',value:12}]),
    createCard('Hibiscus',40,[{name:'Fire Petal',type:'attack',value:20},{name:'Fortify',type:'buff',value:10}]),
    createCard('Dandelion',30,[{name:'Blow Seeds',type:'attack',value:12},{name:'Refresh',type:'buff',value:15}]),
    createCard('Lotus',42,[{name:'Lotus Blast',type:'attack',value:18},{name:'Calm',type:'buff',value:12}]),
    createCard('Violet',35,[{name:'Violet Sting',type:'attack',value:16},{name:'Focus',type:'buff',value:10}])
  ];

  const enemyDeck=[
    createCard('Thorn',30,[{name:'Spike',type:'attack',value:12},{name:'Harden',type:'buff',value:8}]),
    createCard('Venus Flytrap',45,[{name:'Bite',type:'attack',value:18},{name:'Absorb',type:'buff',value:10}]),
    createCard('Cactus',40,[{name:'Prickle',type:'attack',value:15},{name:'Fortify',type:'buff',value:12}]),
    createCard('Poison Ivy',35,[{name:'Poison',type:'attack',value:14},{name:'Toughen',type:'buff',value:8}]),
    createCard('Bramble',38,[{name:'Entangle',type:'attack',value:16},{name:'Resist',type:'buff',value:10}]),
    createCard('Snapdragon',34,[{name:'Fire Breath',type:'attack',value:18},{name:'Shield',type:'buff',value:12}]),
    createCard('Weeping Willow',50,[{name:'Root Grab',type:'attack',value:20},{name:'Regrow',type:'buff',value:15}]),
    createCard('Nightshade',40,[{name:'Shadow Strike',type:'attack',value:17},{name:'Camouflage',type:'buff',value:10}]),
    createCard('Bamboo',36,[{name:'Rapid Slash',type:'attack',value:15},{name:'Fortify',type:'buff',value:12}]),
    createCard('Creeper Vine',32,[{name:'Wrap',type:'attack',value:14},{name:'Harden',type:'buff',value:8}]),
    createCard('Thistle',33,[{name:'Prickly Attack',type:'attack',value:16},{name:'Resist',type:'buff',value:10}]),
    createCard('Mandrake',38,[{name:'Scream',type:'attack',value:18},{name:'Regrow',type:'buff',value:12}]),
    createCard('Elderberry',35,[{name:'Berry Strike',type:'attack',value:15},{name:'Shield',type:'buff',value:12}]),
    createCard('Poison Oak',40,[{name:'Toxic Lash',type:'attack',value:18},{name:'Camouflage',type:'buff',value:10}]),
    createCard('Willowisp',36,[{name:'Spirit Strike',type:'attack',value:17},{name:'Hasten',type:'buff',value:12}])
  ];

  playerCards=draftCards(playerDeck,3);
  enemyCards=draftCards(enemyDeck,3);
}

// ---------------- Rendering & Gameplay ----------------
const playerPanel=document.getElementById('playerPanel');
const enemyPanel=document.getElementById('enemyPanel');
const message=document.getElementById('message');
const optionsDiv=document.getElementById('options');
const gameScreen=document.getElementById('gameScreen');
const winScreen=document.getElementById('winScreen');
const winMessage=document.getElementById('winMessage');

function renderCards(){
playerPanel.innerHTML=''; enemyPanel.innerHTML='';
playerCards.forEach((card,i)=>{
  const div=document.createElement('div');
  div.className='card'; if(i===selectedPlayerCard) div.classList.add('selected');
  div.innerHTML=`<strong>${card.name}</strong>
  <div class="cardData">HP: ${card.hp}/${card.maxHp}<br>Actions:<br>${card.actions.map(a=>a.name).join(', ')}</div>
  <div class="healthBar"><div class="healthFill" style="width:${(card.hp/card.maxHp*100)}%"></div></div>`;
  div.onclick=()=>selectPlayerCard(i);
  playerPanel.appendChild(div);
});
enemyCards.forEach((card,i)=>{
  const div=document.createElement('div');
  div.className='card enemy';
  div.innerHTML=`<strong>${card.name}</strong>
  <div class="cardData">HP: ${card.hp}/${card.maxHp}<br>Actions:<br>${card.actions.map(a=>a.name).join(', ')}</div>
  <div class="healthBar"><div class="healthFill" style="width:${(card.hp/card.maxHp*100)}%"></div></div>`;
  div.onclick=()=>{ 
    if(selectedAction && selectedAction.type==='attack' && selectedPlayerCard!==null){ 
      performAction(selectedPlayerCard,i,selectedAction);
    }
  };
  enemyPanel.appendChild(div);
});
renderOptions();
checkWinLose();
}

function selectPlayerCard(i){selectedPlayerCard=i;selectedAction=null;renderCards();}

function renderOptions(){
optionsDiv.innerHTML='';
if(selectedPlayerCard!==null){
  playerCards[selectedPlayerCard].actions.forEach(action=>{
    const btn=document.createElement('button'); btn.className='optionBtn';
    btn.textContent=action.name;
    btn.onclick=()=>{selectedAction=action; message.textContent=`Selected ${action.name}`; playCardSelect();};
    optionsDiv.appendChild(btn);
  });
}
}

function performAction(playerIndex,enemyIndex,action){
const player=playerCards[playerIndex];
const enemy=enemyCards[enemyIndex];
if(action.type==='attack'){
enemy.hp-=action.value; if(enemy.hp<0) enemy.hp=0; message.textContent=`${player.name} used ${action.name}!`; playAttack();
} else if(action.type==='buff'){
player.hp+=action.value; if(player.hp>player.maxHp) player.hp=player.maxHp; message.textContent=`${player.name} used ${action.name}!`; playHeal();
}
selectedAction=null;
renderCards();
setTimeout(enemyTurn,500);
}
function enemyTurn() {
  if (playerCards.length === 0) return;

  // Pick a random enemy card to act
  const card = enemyCards[Math.floor(Math.random() * enemyCards.length)];

  let action;
  let target;

  // ---- STRATEGIC DECISION ----
  const healActions = card.actions.filter(a => a.type === 'buff');
  const attackActions = card.actions.filter(a => a.type === 'attack');

  // If HP < 40% and healing is available → heal
  if (card.hp < card.maxHp * 0.4 && healActions.length > 0) {
    action = healActions[Math.floor(Math.random() * healActions.length)];
    card.hp += action.value;
    if (card.hp > card.maxHp) card.hp = card.maxHp;
    message.textContent = `Enemy ${card.name} used ${action.name} and healed ${action.value}!`;
    playHeal();
  }
  else if (attackActions.length > 0) {
    // Pick attack action
    action = attackActions[Math.floor(Math.random() * attackActions.length)];
    // Target the weakest player card (lowest HP)
    target = playerCards.reduce((weakest, c) => c.hp < weakest.hp ? c : weakest, playerCards[0]);
    target.hp -= action.value;
    message.textContent = `Enemy ${card.name} used ${action.name} on ${target.name} for ${action.value}!`;
    playAttack();
    if (target.hp <= 0) playerCards = playerCards.filter(c => c !== target);
  }
  else {
    // Fallback: random action if somehow no attack/buff logic applied
    action = card.actions[Math.floor(Math.random() * card.actions.length)];
    if (action.type === 'buff') {
      card.hp += action.value;
      if (card.hp > card.maxHp) card.hp = card.maxHp;
      message.textContent = `Enemy ${card.name} used ${action.name} and healed ${action.value}!`;
      playHeal();
    }
  }

  // Re-render cards and check win/loss
  renderCards();
  if (playerCards.length === 0) return endGame('You Lose!');
}


function checkWinLose(){
const allEnemyDead=enemyCards.every(c=>c.hp<=0);
const allPlayerDead=playerCards.every(c=>c.hp<=0);
if(allEnemyDead){ winScreen.style.display='block'; gameScreen.style.display='none'; winMessage.textContent='You Win!'; playWin();}
if(allPlayerDead){ winScreen.style.display='block'; gameScreen.style.display='none'; winMessage.textContent='You Lose!'; playLose();}
}

function restartGame(){winScreen.style.display='none'; startGame(); gameScreen.style.display='block'; message.textContent='';}

// ---------------- Tips ----------------
const tipsBtn=document.getElementById('tipsBtn');
const tipsPanel=document.getElementById('tipsPanel');
tipsBtn.onclick=()=>tipsPanel.style.display=(tipsPanel.style.display==='none')?'block':'none';

// ---------------- Settings ----------------
const settingsBtn=document.getElementById('settingsBtn');
const settingsPanel=document.getElementById('settingsPanel');
settingsBtn.onclick=()=>settingsPanel.style.display=(settingsPanel.style.display==='none')?'block':'none';
function closeSettings(){settingsPanel.style.display='none';}
document.getElementById('muteMusic').onchange=function(){musicMuted=this.checked; if(!musicMuted) playBackgroundMusic(); else stopBackgroundMusic();}
document.getElementById('muteSFX').onchange=function(){sfxMuted=this.checked;}

// ---------------- Play Button ----------------
const playBtn=document.getElementById('playBtn');
playBtn.onclick=()=>{
  mainMenu.style.display='none';
  gameScreen.style.display='block';
  startGame();
  playBackgroundMusic();
};
</script>

</body>
</html>

